<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>قائمة الطعام</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* ... نفس CSS الموجود عندك بدون تغيير ... */
</style>
</head>
<body>

<header>
  <div class="header-content">
    <div class="logo"><i class="fas fa-utensils"></i><span>مطعمنا الشهي</span></div>
    <a href="cart.html" class="cart-link"><i class="fas fa-shopping-cart"></i> <span>السلة</span></a>
  </div>
</header>

<div class="categories">
  <button class="category-btn active" data-category="all">الكل</button>
  <button class="category-btn" data-category="main">وجبات رئيسية</button>
  <button class="category-btn" data-category="italian">مأكولات ايطالية</button>
  <button class="category-btn" data-category="home">اكل بيتي</button>
  <button class="category-btn" data-category="salads">سلطات</button>
  <button class="category-btn" data-category="sandwiches">ساندويتشات</button>
  <button class="category-btn" data-category="pastries">معجنات</button>
  <button class="category-btn" data-category="drinks">مشروبات</button>
  <button class="category-btn" data-category="extras">اضافات</button>
</div>

<div class="container">
  <h2 class="section-title">الوجبات الرئيسية</h2>
  <div class="menu-container" id="mainDishes"></div>
  <h2 class="section-title">المأكولات الإيطالية</h2>
  <div class="menu-container" id="italianDishes"></div>
  <h2 class="section-title">الأكل البيتي</h2>
  <div class="menu-container" id="homeDishes"></div>
  <h2 class="section-title">السلطات</h2>
  <div class="menu-container" id="salads"></div>
  <h2 class="section-title">الساندويتشات</h2>
  <div class="menu-container" id="sandwiches"></div>
  <h2 class="section-title">المعجنات</h2>
  <div class="menu-container" id="pastries"></div>
  <h2 class="section-title">المشروبات</h2>
  <div class="menu-container" id="drinks"></div>
  <h2 class="section-title">الإضافات</h2>
  <div class="menu-container" id="extras"></div>
</div>

<div class="modal" id="extrasModal">
  <div class="modal-content">
    <h3 id="modalMealName"></h3>
    <div id="extrasContainer" class="extras-grid"></div>
    <div class="modal-buttons">
      <button class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i> إغلاق</button>
      <button class="add-btn" onclick="confirmAddToCart()"><i class="fas fa-cart-plus"></i> أضف للسلة</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT_ID.firebaseapp.com",
    databaseURL: "https://PROJECT_ID.firebaseio.com",
    projectId: "PROJECT_ID",
    storageBucket: "PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  firebase.initializeApp(firebaseConfig);

  let currentUserUID = null;

  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      currentUserUID = user.uid;
      document.body.style.visibility = "visible";
    } else {
      document.body.style.visibility = "visible"; // عرض الصفحة حتى لو لم يسجل الدخول
    }
  });

  const meals = [
    { name:"شاورما لحم", price:30, img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ30gIEfM4I30W_riIrovoJQLTCDMxK3oXzqQ&s", hasExtras:true, category:"main"},
    { name:"شاورما دجاج", price:25, img:"https://i0.wp.com/www.chefahmed.com/wp-content/uploads/2021/04/Chicken-Shawarma-2.jpg", hasExtras:true, category:"main"},
    { name:"صدر دجاج مشوي", price:28, img:"https://assets.nn.najah.edu/CACHE/images/uploads/weblog/2019/06/06/547597762/573f846611235ba9b74a23760c93ec6d.jpg", hasExtras:true, category:"main"},
    { name:"شنيتسل دجاج", price:22, img:"https://yummy.ps/upload/1561530971-seven-hens-photo-taken-at-chicken-schnitzel-eatery-by-on-3-hensley-hitch-price-(1).jpg", hasExtras:true, category:"main"},
    { name:"كفتة مشوية", price:32, img:"https://www.chefahmed.com/wp-content/uploads/2020/06/kofta-kebab.jpg", hasExtras:true, category:"main"},
  ];

  const sections = {
    main:"mainDishes",
    italian:"italianDishes",
    home:"homeDishes",
    salads:"salads",
    sandwiches:"sandwiches",
    pastries:"pastries",
    drinks:"drinks",
    extras:"extras"
  };

  function createMealCard(meal) {
    const div = document.createElement("div");
    div.className = "meal-card";
    div.innerHTML = `
      ${meal.hasExtras ? '<span class="badge">+</span>' : ''}
      <img src="${meal.img}" alt="${meal.name}">
      <div class="meal-content">
        <h3>${meal.name}</h3>
        <span class="price">${meal.price} شيكل</span>
        <button onclick="handleAddClick('${meal.name}', ${meal.price}, ${meal.hasExtras})">
          <i class="fas fa-cart-plus"></i> أضف للسلة
        </button>
      </div>
    `;
    document.getElementById(sections[meal.category]).appendChild(div);
  }

  meals.forEach(createMealCard);

  let currentMeal = null;
  function handleAddClick(name, price, hasExtras){
    if(hasExtras) openExtrasModal(name, price);
    else addToCart(name, price, []);
  }

  function openExtrasModal(name, price) {
    currentMeal = { name, price, extras: [] };
    document.getElementById("modalMealName").innerText = name;
    const container = document.getElementById("extrasContainer");
    container.innerHTML = "";
    const extras = ["جبنة إضافية","صوص خاص","خضار إضافية"];
    extras.forEach(extra => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="checkbox" value="${extra}"> ${extra}`;
      container.appendChild(label);
    });
    document.getElementById("extrasModal").style.display = "block";
  }

  function closeModal() { document.getElementById("extrasModal").style.display = "none"; }

  function confirmAddToCart() {
    const checkboxes = document.querySelectorAll("#extrasContainer input:checked");
    const extras = Array.from(checkboxes).map(cb => cb.value);
    addToCart(currentMeal.name, currentMeal.price, extras);
    closeModal();
  }

  function addToCart(name, price, extras) {
    if(!currentUserUID) { alert("الرجاء تسجيل الدخول"); return; }
    const cartRef = firebase.database().ref("carts/" + currentUserUID);
    const newItemRef = cartRef.push();
    newItemRef.set({ name, price, extras });
    alert("تمت الإضافة إلى السلة ✅");
  }

  const categoryButtons = document.querySelectorAll(".category-btn");
  categoryButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      categoryButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      const cat = btn.dataset.category;
      filterMealsByCategory(cat);
    });
  });

  function filterMealsByCategory(category) {
    Object.keys(sections).forEach(sec => {
      document.getElementById(sections[sec]).parentElement.style.display = (category=="all" || category==sec) ? "block" : "none";
    });
  }
</script>

</body>
</html>
