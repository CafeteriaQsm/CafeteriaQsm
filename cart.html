<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>سلة الطلبات</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>
<h1>سلة الطلبات</h1>

<div id="cart-container"></div>
<h3 id="total-price">المجموع: 0₪</h3>

<script>
// ===== إعداد Firebase =====
const firebaseConfig = {
  apiKey: "API_KEY_HERE",
  authDomain: "PROJECT_ID.firebaseapp.com",
  databaseURL: "https://PROJECT_ID.firebaseio.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);

// ===== بيانات المستخدم التجريبية =====
const currentUserUID = "guest_user"; // نفس UID المستخدم في menu.html

// ===== عرض السلة =====
const cartContainer = document.getElementById("cart-container");
const totalPriceEl = document.getElementById("total-price");

function updateCart(snapshot) {
  cartContainer.innerHTML = "";
  let total = 0;
  const cartItems = snapshot.val();
  if (!cartItems) {
    cartContainer.innerHTML = "<p>السلة فارغة</p>";
    totalPriceEl.textContent = "المجموع: 0₪";
    return;
  }

  for (const key in cartItems) {
    const item = cartItems[key];
    total += item.price;
    const div = document.createElement("div");
    div.innerHTML = `
      <h3>${item.name}</h3>
      <img src="${item.img}" width="150" />
      <p>السعر: ${item.price}₪</p>
      <button onclick='removeItem("${key}")'>حذف</button>
      <hr>
    `;
    cartContainer.appendChild(div);
  }
  totalPriceEl.textContent = "المجموع: " + total + "₪";
}

// ===== حذف عنصر من السلة =====
function removeItem(itemKey) {
  const itemRef = firebase.database().ref("carts/" + currentUserUID + "/" + itemKey);
  itemRef.remove().catch(error => console.error("خطأ عند الحذف:", error));
}

// ===== متابعة التحديثات =====
const cartRef = firebase.database().ref("carts/" + currentUserUID);
cartRef.on("value", updateCart);
</script>
</body>
</html>
